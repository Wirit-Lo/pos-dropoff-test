import shutil
import os
import time
import stat

def force_update_backup():
    # ==========================================
    # üîß ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå (Absolute Paths)
    # ==========================================
    # ‡πÉ‡∏™‡πà r ‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Path ‡∏Ç‡∏≠‡∏á Windows
    src_path = r"D:\EWT\Automate POS"
    dest_path = r"D:\EWT\Automate POS - Backup"

    print("-" * 60)
    print(f"üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£ Force Update Backup")
    print(f"üìÇ ‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö: {src_path}")
    print(f"üìÇ ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á: {dest_path}")
    print("-" * 60)

    # 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏à‡∏≠‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÑ‡∏´‡∏°
    if not os.path.exists(src_path):
        print(f"‚ùå Error: ‡∏´‡∏≤‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠!")
        print(f"   (‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏≠‡∏á‡∏´‡∏≤‡∏ó‡∏µ‡πà: {src_path})")
        return

    try:
        # ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏Å‡πâ Permission (‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Å ‡∏•‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
        def on_rm_error(func, path, exc_info):
            os.chmod(path, stat.S_IWRITE)
            try:
                os.unlink(path)
            except:
                pass

        # 2. ‡∏•‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏¥‡πâ‡∏á‡πÅ‡∏ö‡∏ö‡∏ñ‡∏≠‡∏ô‡∏£‡∏≤‡∏Å‡∏ñ‡∏≠‡∏ô‡πÇ‡∏Ñ‡∏ô
        if os.path.exists(dest_path):
            print("üóëÔ∏è  ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö Backup ‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏¥‡πâ‡∏á... (Clean Wipe)")
            shutil.rmtree(dest_path, onerror=on_rm_error)
            time.sleep(2) # ‡∏û‡∏±‡∏Å‡∏´‡∏≤‡∏¢‡πÉ‡∏à 2 ‡∏ß‡∏¥ ‡πÉ‡∏´‡πâ Windows ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÑ‡∏ü‡∏•‡πå
        else:
            print("‚ÑπÔ∏è  ‡πÑ‡∏°‡πà‡∏û‡∏ö Backup ‡πÄ‡∏Å‡πà‡∏≤ (‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏•‡∏¢)")

        # 3. ‡∏Å‡πá‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡πÑ‡∏õ
        print("üì¶ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà (Copying)...")
        shutil.copytree(src_path, dest_path)
        
        print("-" * 60)
        print("‚úÖ‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå! Backup ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß")
        print("-" * 60)

    except Exception as e:
        print(f"üî• ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: {e}")
        print("üëâ ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÉ‡∏´‡πâ‡∏õ‡∏¥‡∏î‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° VS Code ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏≠‡∏¢‡∏π‡πà ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà")

if __name__ == "__main__":
    force_update_backup()
    input("‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á...")